.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "zelta\-prune" "8" "" "" "System Manager\(cqs Manual"
.SH NAME
\f[B]zelta prune\f[R] \- identify snapshots safe for deletion based on
backup state
.SH SYNOPSIS
\f[B]zelta prune\f[R] [\f[I]OPTIONS\f[R]] \f[I]source\f[R]
\f[I]target\f[R]
.SH DESCRIPTION
\f[B]zelta prune\f[R] identifies snapshots on a source dataset that have
been safely replicated to a target and are eligible for deletion based
on retention policies.
This command is useful for managing snapshot accumulation on production
systems while ensuring backup integrity.
.PP
\f[B]zelta prune\f[R] only suggests snapshots for deletion\(emit does
not delete them.
Output is provided in a format suitable for review before execution.
.PP
As with other Zelta commands, \f[B]zelta prune\f[R] works recursively on
dataset trees.
Both source and target may be local or remote via \f[B]ssh(1)\f[R].
.SS Safety Criteria
\f[B]WARNING:\f[R] \f[CR]zelta prune\f[R] is a new feature currently in
production testing and will be formally released in Zelta 1.2 (May
2026).
.PP
A snapshot is considered safe to prune only if:
.IP "1." 3
The snapshot exists on the target (has been replicated)
.IP "2." 3
The snapshot is older than the most recent common match point
.IP "3." 3
The snapshot meets the minimum retention requirements
.PP
Snapshots newer than the common match point are never suggested for
deletion, as they may be needed for future incremental replication.
.PP
Remote endpoint names follow \f[B]scp(1)\f[R] conventions.
Dataset names follow \f[B]zfs(8)\f[R] naming conventions.
.SH OPTIONS
\f[B]Endpoint Arguments (Required)\f[R]
.TP
\f[I]source\f[R]
The dataset tree containing snapshots to evaluate for pruning.
.TP
\f[I]target\f[R]
The backup dataset tree used to verify replication status.
.PP
\f[B]Output Options\f[R]
.TP
\f[B]\-v, \-\-verbose\f[R]
Increase verbosity.
Specify once for operational detail, twice (\f[CR]\-vv\f[R]) for debug
output.
.TP
\f[B]\-q, \-\-quiet\f[R]
Quiet output.
Specify once to suppress warnings, twice (\f[CR]\-qq\f[R]) to suppress
errors.
.TP
\f[B]\-n, \-\-dryrun, \-\-dry\-run\f[R]
Display \f[CR]zfs\f[R] commands without executing them.
.PP
\f[B]Retention Options\f[R]
.TP
\f[B]\-\-keep\-snap\-num\f[R] \f[I]N\f[R]
Minimum number of snapshots to keep after the match point.
Default: 100.
.TP
\f[B]\-\-keep\-snap\-days\f[R] \f[I]N\f[R]
Minimum age in days before a snapshot is eligible for deletion.
Default: 90.
.TP
\f[B]\-\-no\-ranges\f[R]
Disable range compression in output.
By default, consecutive snapshots are displayed as ranges (e.g.,
\f[CR]snap1%snap5\f[R]).
This option outputs individual snapshot names, one per line.
.PP
\f[B]Dataset Options\f[R]
.TP
\f[B]\-d, \-\-depth\f[R] \f[I]LEVELS\f[R]
Limit recursion depth.
For example, a depth of 1 includes only the specified dataset.
.TP
\f[B]\-X, \-\-exclude\f[R] \f[I]PATTERN\f[R]
Exclude datasets matching the specified pattern.
See \f[B]zelta\-options(7)\f[R] for pattern syntax.
.SH OUTPUT FORMAT
By default, \f[B]zelta prune\f[R] outputs snapshot ranges using ZFS
range syntax:
.IP
.EX
pool/dataset\(atoldest_snap%newest_snap
.EE
.PP
This format is compatible with \f[CR]zfs destroy\f[R] for batch
deletion.
With \f[CR]\-\-no\-ranges\f[R], individual snapshot names are output one
per line.
.SH EXAMPLES
Identify prunable snapshots with default retention (100 snapshots, 90
days):
.IP
.EX
zelta prune tank/data backup\-host.example:tank/backups/data
.EE
.PP
Use stricter retention (keep 200 snapshots, 180 days minimum age):
.IP
.EX
zelta prune \-\-keep\-snap\-num=200 \-\-keep\-snap\-days=180 \(rs
    tank/data backup\-host.example:tank/backups/data
.EE
.PP
Output individual snapshots instead of ranges:
.IP
.EX
zelta prune \-\-no\-ranges tank/data backup\-host.example:tank/backups/data
.EE
.PP
Review and then delete prunable snapshots:
.IP
.EX
# First, review what would be deleted
zelta prune tank/data backup:tank/backups/data

# If satisfied, pipe to xargs for deletion (use with caution)
zelta prune tank/data backup:tank/backups/data | xargs \-n1 zfs destroy
.EE
.PP
Exclude temporary datasets from consideration:
.IP
.EX
zelta prune \-X \(aq*/tmp\(aq tank/data backup:tank/backups/data
.EE
.SH EXIT STATUS
Returns 0 on success, non\-zero on error.
.SH NOTES
\f[B]zelta prune\f[R] is experimental.
Always review output before executing deletions.
.PP
This command is driven by the \f[B]zelta match\f[R] comparison engine.
See \f[B]zelta\-match(8)\f[R] for details on how source and target
snapshots are compared.
.PP
See \f[B]zelta\-options(7)\f[R] for environment variables and
\f[CR]zelta.env\f[R] configuration.
.SH SEE ALSO
zelta(8), zelta\-options(7), zelta\-match(8), zelta\-backup(8), zfs(8),
zfs\-destroy(8)
.SH AUTHORS
Daniel J. Bell <\f[I]bellhyve\(atzelta.space\f[R]>
.SH WWW
https://zelta.space
